<div class="tz-calculator">
  <h2>Timezone Calculator</h2>
  <form (ngSubmit)="addConversion()" class="tz-form" #tzForm="ngForm">
    <div class="row">
      <label>Fecha / Hora Local 1</label>
      <input type="datetime-local" [(ngModel)]="form.localDateTime" name="localDateTime" required />
    </div>

    <div class="row group">
      <div>
        <label>País Local</label>
        <select [(ngModel)]="form.localCountry" name="localCountry" (change)="onLocalCountryChange()" required>
          <option *ngFor="let c of countries" [value]="c.code">{{c.name}}</option>
        </select>
      </div>
      <div *ngIf="form.localCountry==='US'">
        <label>Estado Local</label>
        <select [(ngModel)]="form.localState" name="localState" (change)="onLocalStateChange()">
          <option *ngFor="let s of usStates" [value]="s.code">{{s.name}}</option>
        </select>
      </div>
      <div>
        <label>Timezone Local</label>
        <select [(ngModel)]="form.localTimezone" name="localTimezone" required>
          <option *ngFor="let tz of localTimezoneOptions" [value]="tz.timezone">{{tz.display_name}} ({{tz.utc_offset}})</option>
        </select>
      </div>
    </div>

    <div class="row group">
      <div>
        <label>País Objetivo</label>
        <select [(ngModel)]="form.targetCountry" name="targetCountry" (change)="onTargetCountryChange()" required>
          <option *ngFor="let c of countries" [value]="c.code">{{c.name}}</option>
        </select>
      </div>
      <div *ngIf="form.targetCountry==='US'">
        <label>Estado Objetivo</label>
        <select [(ngModel)]="form.targetState" name="targetState" (change)="onTargetStateChange()">
          <option *ngFor="let s of usStates" [value]="s.code">{{s.name}}</option>
        </select>
      </div>
      <div>
        <label>Timezone Objetivo</label>
        <select [(ngModel)]="form.targetTimezone" name="targetTimezone" required>
          <option *ngFor="let tz of targetTimezoneOptions" [value]="tz.timezone">{{tz.display_name}} ({{tz.utc_offset}})</option>
        </select>
      </div>
    </div>

    <button type="submit" [disabled]="!tzForm.form.valid">Convertir</button>
  </form>

  <div class="results" *ngIf="rows.length">
    <h3>Resultados</h3>
    <table>
      <thead>
        <tr>
          <th>Hora Local 1</th>
          <th>UTC</th>
          <th>Hora Local 2</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>
            <div>{{r.local1 | date:'yyyy-MM-dd HH:mm:ss'}}<span class="dst" *ngIf="r.local1Dst"> DST</span></div>
            <small>{{r.localTz.display_name}} ({{r.localTz.utc_offset}})</small>
          </td>
          <td>{{r.utc | date:'yyyy-MM-dd HH:mm:ss'}}</td>
          <td>
            <div>{{r.local2 | date:'yyyy-MM-dd HH:mm:ss'}}<span class="dst" *ngIf="r.local2Dst"> DST</span></div>
            <small>{{r.targetTz.display_name}} ({{r.targetTz.utc_offset}})</small>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="details" *ngIf="form.localTimezone">
    <h3>Detalle Zona Local</h3>
    <div *ngFor="let tz of localTimezoneOptions" class="tz-detail" [class.active]="tz.timezone===form.localTimezone">
      <strong>{{tz.display_name}}</strong> - {{tz.timezone}}<br>
      Offset: {{tz.utc_offset}}<br>
      DST: {{tz.dst_aware ? 'Sí' : 'No'}} <span *ngIf="tz.dst_aware">({{tz.dst_start}} → {{tz.dst_end}})</span>
    </div>
  </div>
</div>
