<div class="institution-profile-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p class="loading-text">{{'profile.loading' | translate}}</p>
  </div>

  <!-- Institution Profile Content -->
  <div *ngIf="!isLoading" class="profile-content">
    <ng-container *ngIf="institution$ | async as institution">
      
      <!-- Header Section with Professional Layout -->
      <mat-card class="institution-header-card">
        <mat-card-header class="institution-header">
          <div class="institution-logo">
            <img 
              *ngIf="institution.logo_url; else defaultLogo"
              [src]="institution.logo_url" 
              [alt]="institution.name"
              class="logo-image">
            <ng-template #defaultLogo>
              <div class="default-logo">
                <mat-icon>business</mat-icon>
              </div>
            </ng-template>
          </div>
          
          <div class="institution-info">
            <mat-card-title class="institution-name">
              {{ institution.name }}
            </mat-card-title>
            
            <mat-card-subtitle class="institution-subtitle">
              <div class="subtitle-row">
                <span class="institution-type">
                  <mat-icon>school</mat-icon>
                  Institution
                </span>
                
                <span class="location" *ngIf="institution.country">
                  <mat-icon>location_on</mat-icon>
                  {{ institution.country }}
                </span>
              </div>
              
              <!-- Contact Information Row -->
              <div class="contact-row" *ngIf="getContactInfo(institution).length > 0">
                <mat-chip-listbox class="contact-chips">
                  <mat-chip *ngFor="let contact of getContactInfo(institution)" class="contact-chip">
                    {{ contact }}
                  </mat-chip>
                </mat-chip-listbox>
              </div>
            </mat-card-subtitle>
          </div>
          
          <!-- Actions -->
          <div class="institution-actions" *ngIf="!userId">
            <button 
              mat-raised-button 
              color="primary" 
              class="edit-button"
              (click)="openEditDialog()">
              <mat-icon>edit</mat-icon>
              {{'profile.edit' | translate}}
            </button>
          </div>
        </mat-card-header>
        
        <!-- Description -->
        <mat-card-content *ngIf="institution.description" class="institution-description">
          <mat-divider></mat-divider>
          <p class="description-text">{{ institution.description }}</p>
        </mat-card-content>
      </mat-card>

      <!-- Statistics Section -->
      <div class="stats-section" *ngIf="stats$ | async as stats">
        <div class="stats-grid">
          
          <!-- Tutors Stats Card -->
          <mat-card class="stat-card tutors-card">
            <mat-card-header>
              <mat-card-title class="stat-title">
                <mat-icon class="stat-icon">person</mat-icon>
                {{'profile.tutors' | translate}}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ stats.tutorsCount }}</div>
              <div class="recent-list" *ngIf="stats.recentTutors.length > 0">
                <div class="recent-title">{{'profile.recent' | translate}}:</div>
                <div class="recent-items">
                  <span 
                    *ngFor="let tutor of stats.recentTutors; let last = last" 
                    class="recent-name">
                    {{ tutor.full_name }}{{ !last ? ',' : '' }}
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Students Stats Card -->
          <mat-card class="stat-card students-card">
            <mat-card-header>
              <mat-card-title class="stat-title">
                <mat-icon class="stat-icon">school</mat-icon>
                {{'profile.students' | translate}}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="stat-number">{{ stats.studentsCount }}</div>
              <div class="recent-list" *ngIf="stats.recentStudents.length > 0">
                <div class="recent-title">{{'profile.recent' | translate}}:</div>
                <div class="recent-items">
                  <span 
                    *ngFor="let student of stats.recentStudents; let last = last" 
                    class="recent-name">
                    {{ student.full_name }}{{ !last ? ',' : '' }}
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

        </div>
      </div>

    </ng-container>

    <!-- Empty State -->
    <mat-card *ngIf="(institution$ | async) === null" class="empty-state-card">
      <mat-card-content class="empty-state">
        <mat-icon class="empty-icon">business</mat-icon>
        <h3>{{'profile.not_found' | translate}}</h3>
        <p>{{'profile.not_found_description' | translate}}</p>
      </mat-card-content>
    </mat-card>
  </div>
</div>
