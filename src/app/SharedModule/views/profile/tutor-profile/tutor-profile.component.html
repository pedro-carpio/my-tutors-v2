<div class="tutor-profile-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p class="loading-text">{{'profile.loading' | translate}}</p>
  </div>

  <!-- Tutor Profile Content -->
  <div *ngIf="!isLoading" class="profile-content">
    <!-- Tutor Found -->
    <ng-container *ngIf="(tutor$ | async) !== undefined && (tutor$ | async) !== null">
      <ng-container *ngIf="tutor$ | async as tutor">
        
        <!-- Header Section with Professional Layout -->
        <mat-card class="tutor-header-card">
          <mat-card-header class="tutor-header">
            <div class="tutor-photo">
              <img 
                *ngIf="tutor.photo_url; else defaultPhoto"
                [src]="tutor.photo_url" 
                [alt]="tutor.full_name"
                class="photo-image">
              <ng-template #defaultPhoto>
                <div class="default-photo">
                  <mat-icon>person</mat-icon>
                </div>
              </ng-template>
            </div>
            
            <div class="tutor-info">
              <mat-card-title class="tutor-name">
                {{ tutor.full_name }}
              </mat-card-title>
              
              <mat-card-subtitle class="tutor-subtitle">
                <div class="subtitle-row">
                  <span class="tutor-type">
                    <mat-icon>school</mat-icon>
                    {{ 'roles.tutor' | translate }}
                  </span>
                  
                  <span class="location" *ngIf="tutor.country">
                    <mat-icon>location_on</mat-icon>
                    {{ tutor.country }}
                  </span>
                  
                  <span class="experience" *ngIf="tutor.experience_level">
                    <mat-icon>trending_up</mat-icon>
                    {{ getExperienceLevelText(tutor.experience_level) }}
                  </span>
                </div>
                
                <!-- Contact Information Row -->
                <div class="contact-row" *ngIf="getContactInfo(tutor).length > 0">
                  <mat-chip-listbox class="contact-chips">
                    <mat-chip *ngFor="let contact of getContactInfo(tutor)" class="contact-chip">
                      {{ contact }}
                    </mat-chip>
                  </mat-chip-listbox>
                </div>
              </mat-card-subtitle>
            </div>
            
            <!-- Actions -->
            <div class="tutor-actions" *ngIf="!userId">
              <button 
                mat-raised-button 
                color="primary" 
                class="edit-button"
                (click)="openEditDialog()">
                <mat-icon>edit</mat-icon>
                {{'profile.edit' | translate}}
              </button>
            </div>
          </mat-card-header>
          
          <!-- Biography -->
          <mat-card-content *ngIf="tutor.bio" class="tutor-biography">
            <mat-divider></mat-divider>
            <p class="biography-text">{{ tutor.bio }}</p>
          </mat-card-content>
        </mat-card>

        <!-- Professional Information Section -->
        <div class="professional-section">
          <div class="professional-grid">
            
            <!-- Professional Info Card -->
            <mat-card class="info-card professional-card">
              <mat-card-header>
                <mat-card-title class="info-title">
                  <mat-icon class="info-icon">work</mat-icon>
                  {{'profile.professionalInfo' | translate}}
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="info-details">
                  <div class="detail-item" *ngIf="tutor.hourly_rate">
                    <mat-icon>attach_money</mat-icon>
                    <span>{{ tutor.hourly_rate }} {{ tutor.hourly_rate_currency || 'USD' }}/{{ 'profile.hour' | translate }}</span>
                  </div>
                  <div class="detail-item" *ngIf="tutor.max_hours_per_week">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ tutor.max_hours_per_week }}/{{ 'profile.week' | translate }}</span>
                  </div>
                  <div class="detail-item" *ngIf="tutor.timezone">
                    <mat-icon>access_time</mat-icon>
                    <span>{{ tutor.timezone }}</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Teaching Languages Card -->
            <mat-card class="info-card teaching-languages-card">
              <mat-card-header>
                <mat-card-title class="info-title">
                  <mat-icon class="info-icon">school</mat-icon>
                  {{'profile.teachingLanguages' | translate}}
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div *ngIf="teachingLanguages$ | async as languages; else noTeachingLanguages" class="languages-list">
                  <div *ngFor="let lang of languages" class="teaching-language-item">
                    <span class="language-name">{{ lang.language_id }}</span> -
                    <span class="language-level">{{ lang.level_cefr }}</span>
                    <mat-icon *ngIf="lang.is_native" class="native-icon" matTooltip="Idioma nativo">star</mat-icon>
                  </div>
                </div>
                <ng-template #noTeachingLanguages>
                  <p class="no-data">{{'profile.noTeachingLanguages' | translate}}</p>
                </ng-template>
              </mat-card-content>
            </mat-card>

            <!-- Spoken Languages Card -->
            <mat-card class="info-card spoken-languages-card">
              <mat-card-header>
                <mat-card-title class="info-title">
                  <mat-icon class="info-icon">translate</mat-icon>
                  {{'profile.spokenLanguages' | translate}}
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div *ngIf="spokenLanguages$ | async as languages; else noSpokenLanguages" class="languages-list">
                  <div *ngFor="let lang of languages" class="language-item">
                    <span class="language-name">{{ lang.language_id }}</span>-
                    <span class="language-level">{{ lang.level_cefr }}</span>
                    <mat-icon *ngIf="lang.is_native" class="native-icon" matTooltip="Idioma nativo">star</mat-icon>
                  </div>
                </div>
                <ng-template #noSpokenLanguages>
                  <p class="no-data">{{'profile.noSpokenLanguages' | translate}}</p>
                </ng-template>
              </mat-card-content>
            </mat-card>

          </div>
        </div>

        <!-- Usar el componente de disponibilidad -->
        <app-availability [tutorId]="getCurrentUserId()"></app-availability>

        <!-- Certifications Section -->
        <mat-card class="certifications-card">
          <mat-card-header>
            <mat-card-title class="info-title">
              <mat-icon class="info-icon">verified</mat-icon>
              {{'profile.certifications' | translate}}
            </mat-card-title>
            <button mat-icon-button 
                    (click)="openCertificatesDialog()"
                    matTooltip="{{ 'profile.manageCertifications' | translate }}"
                    class="manage-button">
              <mat-icon>edit</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <!-- Certificaciones de Enseñanza -->
            <div *ngIf="tutor.certifications && tutor.certifications.length > 0" 
                 class="teaching-certifications-section">
              <div class="certifications-grid">
                <div *ngFor="let cert of tutor.certifications" class="certification-item">
                  <div class="cert-image" *ngIf="cert.image_url">
                    <img [src]="cert.image_url" [alt]="cert.name" class="cert-thumbnail">
                  </div>
                  <div class="cert-info">
                    <h4>{{ cert.name }}</h4>
                    <p *ngIf="cert.issuer" class="cert-issuer">
                      <mat-icon>business</mat-icon>
                      {{ cert.issuer }}
                    </p>
                    <p *ngIf="cert.issue_date" class="cert-date">
                      <mat-icon>date_range</mat-icon>
                      {{ cert.issue_date | date:'MM/yyyy' }}
                    </p>
                    <p *ngIf="cert.description" class="cert-description">{{ cert.description }}</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Certificaciones de Idiomas -->
            <div *ngIf="tutor.language_certifications && tutor.language_certifications.length > 0" 
                 class="language-certifications-section">
              <h4 class="section-subtitle">
                <mat-icon>translate</mat-icon>
                {{'profile.languageCertifications' | translate}}
              </h4>
              <div class="certifications-grid">
                <div *ngFor="let cert of tutor.language_certifications" class="certification-item">
                  <div class="cert-image" *ngIf="cert.image_url">
                    <img [src]="cert.image_url" [alt]="cert.name" class="cert-thumbnail">
                  </div>
                  <div class="cert-info">
                    <h5>{{ cert.name }}</h5>
                    <p *ngIf="cert.language_code" class="cert-language">
                      <mat-icon>language</mat-icon>
                      {{ cert.language_code | uppercase }}
                      <span *ngIf="cert.level_cefr" class="cert-level">- {{ cert.level_cefr }}</span>
                    </p>
                    <p *ngIf="cert.issuer" class="cert-issuer">
                      <mat-icon>business</mat-icon>
                      {{ cert.issuer }}
                    </p>
                    <p *ngIf="cert.score" class="cert-score">
                      <mat-icon>grade</mat-icon>
                      {{ 'profile.score' | translate }}: {{ cert.score }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Estado vacío si no hay certificaciones -->
            <div *ngIf="(!tutor.certifications || tutor.certifications.length === 0) && 
                        (!tutor.language_certifications || tutor.language_certifications.length === 0)" 
                 class="empty-cert-content">
              <mat-icon class="empty-icon">verified</mat-icon>
              <h3>{{'profile.noCertifications' | translate}}</h3>
              <p>{{'profile.noCertificationsDescription' | translate}}</p>
              <button mat-raised-button color="primary" (click)="openCertificatesDialog()">
                <mat-icon>add</mat-icon>
                {{'profile.addCertifications' | translate}}
              </button>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Social Links Section -->
        <mat-card *ngIf="tutor.linkedin_profile" class="social-card">
          <mat-card-header>
            <mat-card-title class="info-title">
              <mat-icon class="info-icon">link</mat-icon>
              {{'profile.socialProfiles' | translate}}
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="social-links">
              <a [href]="tutor.linkedin_profile" target="_blank" mat-raised-button color="primary">
                <mat-icon>link</mat-icon>
                LinkedIn
              </a>
            </div>
          </mat-card-content>
        </mat-card>

      </ng-container>
    </ng-container>

    <!-- Empty State - Tutor not found -->
    <mat-card *ngIf="(tutor$ | async) === undefined" class="empty-state-card">
      <mat-card-content class="empty-state">
        <mat-icon class="empty-icon">person</mat-icon>
        <h3>{{'profile.not_found' | translate}}</h3>
        <p>{{'profile.tutor_not_found_description' | translate}}</p>
        
        <!-- Botón para crear perfil de tutor -->
        <div class="empty-state-actions">
          <button 
            mat-raised-button 
            color="primary"
            (click)="createTutorProfile()">
            <mat-icon>add</mat-icon>
            Crear Perfil de Tutor
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
