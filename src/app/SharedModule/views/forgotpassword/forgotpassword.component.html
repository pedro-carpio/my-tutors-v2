<div class="forgot-password-container">
    <!-- Toolbar -->
  <app-toolbar></app-toolbar>
  <mat-card class="forgot-password-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>lock_reset</mat-icon>
        {{ i18nService.translate('auth.forgotPassword.title') }}
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Success state - email sent -->
      <div *ngIf="emailSent" class="success-section">
        <div class="success-icon">
          <mat-icon color="primary">check_circle</mat-icon>
        </div>
        <h3>{{ i18nService.translate('auth.forgotPassword.emailSent') }}</h3>
        <p>{{ i18nService.translate('auth.forgotPassword.emailSentMessage') }}</p>
        <p class="instructions">
          {{ i18nService.translate('auth.forgotPassword.checkInbox') }}
        </p>
        <div class="support-section">
          <p class="support-text">{{ i18nService.translate('auth.forgotPassword.needHelp') }}</p>
          <div class="support-links">
            <a href="https://wa.me/59177914381" target="_blank">
              <button mat-stroked-button
                    color="primary">
                <mat-icon>chat</mat-icon>
              {{ i18nService.translate('auth.forgotPassword.whatsappSupport') }}
            </button>
            </a>
            <a href="mailto:hello@mytutors.click">
              <button mat-stroked-button
                    color="primary">
                <mat-icon>email</mat-icon>
              {{ i18nService.translate('auth.forgotPassword.emailSupport') }}
            </button>
            </a>
          </div>
        </div>
        
        <div class="action-buttons">
          <button mat-raised-button 
                  color="primary" 
                  (click)="goBackToLogin()"
                  class="full-width-btn">
            <mat-icon>arrow_back</mat-icon>
            {{ i18nService.translate('auth.forgotPassword.backToLogin') }}
          </button>
          
          <button mat-button 
                  (click)="resendEmail()"
                  [disabled]="isLoading"
                  class="resend-btn">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <span *ngIf="!isLoading">{{ i18nService.translate('auth.forgotPassword.resendEmail') }}</span>
            <span *ngIf="isLoading">{{ i18nService.translate('auth.forgotPassword.sending') }}</span>
          </button>
        </div>
      </div>

      <!-- Form state - enter email -->
      <div *ngIf="!emailSent" class="form-section">
        <p class="description">
          {{ i18nService.translate('auth.forgotPassword.description') }}
        </p>

        <form [formGroup]="resetForm" (ngSubmit)="onResetPassword()" class="reset-form">
          <!-- Email field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ i18nService.translate('auth.forgotPassword.email') }}</mat-label>
            <input matInput 
                   type="email" 
                   formControlName="email"
                   [placeholder]="i18nService.translate('auth.forgotPassword.emailPlaceholder')"
                   [class.mat-form-field-invalid]="resetForm.get('email')?.invalid && resetForm.get('email')?.touched">
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="resetForm.get('email')?.invalid && resetForm.get('email')?.touched">
              {{ getEmailErrorMessage() }}
            </mat-error>
          </mat-form-field>

          <!-- Error message -->
          <div *ngIf="errorMessage" class="error-message">
            <mat-icon color="warn">error</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>

          <!-- Submit button -->
          <button mat-raised-button 
                  color="primary" 
                  type="submit"
                  class="submit-btn full-width-btn"
                  [disabled]="resetForm.invalid || isLoading">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isLoading">send</mat-icon>
            <span *ngIf="!isLoading">{{ i18nService.translate('auth.forgotPassword.sendLink') }}</span>
            <span *ngIf="isLoading">{{ i18nService.translate('auth.forgotPassword.sending') }}</span>
          </button>

          <!-- Back to login -->
          <button mat-button 
                  type="button"
                  class="back-to-login-btn"
                  (click)="goBackToLogin()">
            <mat-icon>arrow_back</mat-icon>
            {{ i18nService.translate('auth.forgotPassword.backToLogin') }}
          </button>
        </form>

        <!-- Support section -->
        <div class="support-section">
          <p class="support-text">{{ i18nService.translate('auth.forgotPassword.needHelp') }}</p>
          <div class="support-links">
            <a href="https://wa.me/59177914381" target="_blank">
              <button mat-stroked-button
                    color="primary">
                <mat-icon>chat</mat-icon>
              {{ i18nService.translate('auth.forgotPassword.whatsappSupport') }}
            </button>
            </a>
            <a href="mailto:hello@mytutors.click">
              <button mat-stroked-button
                    color="primary">
                <mat-icon>email</mat-icon>
              {{ i18nService.translate('auth.forgotPassword.emailSupport') }}
            </button>
            </a>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>